View(fac_caps)
View(facs)
View(miss_caps)
fac_caps <- read_csv("fac_captures.csv")
View(fac_caps)
View(fac_caps)
facs <- read_csv("facilities.csv")[-1]
missiles <- read_csv("missiles.csv")[-1]
sat <- read_csv("sat.csv")[-1] # satellite photo polygons
# create Simple Features DFs
facs_sf <- st_as_sf(facs, coords = c("lng", "lat"), remove = FALSE)
miss_sf <- st_as_sf(missiles, coords = c("lng", "lat"), remove = FALSE)
sat_sf <- st_as_sf(sat, wkt = "geometry")
View(facs_sf)
sat_sf <- sat_sf %>% mutate(polygon_geometry = geometry) # duplicate polygons because otherwise they'll be removed
# Perform a spatial join to find points within polygons
fac_captures <- st_join(x = facs_sf, y = sat_sf, join = st_within, left = FALSE)
View(fac_captures)
?st_join
# Perform a spatial join to find points within polygons
fac_captures <- st_join(x = facs_sf, y = sat_sf, join = st_within)
?write-csv
?write.csv
fac_captures$geometry
fac_captures$geometry
as.character(fac_captures$geometry)
fac_captures$geometry
st_as_text(fac_captures$geometry)
# Perform a spatial join to find points within polygons
fac_captures <- st_join(x = facs_sf, y = sat_sf, join = st_within)
fac_captures$geometry <- st_as_text(fac_captures$geometry)
fac_captures$polygon_geometry <- st_as_text(fac_captures$polygon_geometry)
# filter the dataset to remove cases where the photo was taken before construction started
fac_captures <- fac_captures %>% filter(start_date <= Acquisitio)
write.csv(fac_captures, "fac_captures.csv")
?transform.sf
# Perform a spatial join to find points within polygons
fac_captures <- st_join(x = facs_sf, y = sat_sf, join = st_within)
fac_captures$geometry <- st_as_text(fac_captures$geometry)
fac_captures$polygon_geometry <- st_as_text(fac_captures$polygon_geometry)
# filter the dataset to remove cases where the photo was taken before construction started
fac_captures <- fac_captures %>%
filter(start_date <= Acquisitio) %>%
as.data.frame()
write.csv(fac_captures, "fac_captures.csv")
fac_caps <- read_csv("fac_captures.csv")[-1]
View(fac_caps)
# Perform a spatial join to find points within polygons
miss_captures <- st_join(x = miss_sf, y = sat_sf, join = st_within)
# convert SF geometry columns to characters to avoid CSV file formatting issues
miss_captures$geometry <- st_as_text(miss_captures$geometry)
miss_captures$polygon_geometry <- st_as_text(miss_captures$polygon_geometry)
# filter the dataset to remove cases where the photo was taken before construction started
miss_captures <- miss_captures %>%
filter(start_date <= Acquisitio,
ifelse(!is.na(end_date), end_date >= Acquisitio, TRUE)) %>%
as.data.frame() # convert from SF back to regular DF
write.csv(miss_captures, "miss_captures.csv")
facs <- read_csv("facilities.csv")[-1]
missiles <- read_csv("missiles.csv")[-1]
fac_caps <- read_csv("fac_captures.csv")[-1]
miss_caps <- read_csv("miss_captures.csv")[-1]
# get date range
min_date = min(append(facs$start_date, missiles$start_date), na.rm = TRUE)
max_date = max(append(facs$start_date, missiles$start_date), na.rm = TRUE)
View(facs)
View(fac_caps)
coverage <- data.frame(year = integer(),
num_extant_facilities = integer(),
num_spotted_facilities = integer(),
coverage = double())
spotted <- c()
for (year in as.integer(format(min_date, "%Y")):as.integer(format(max_date, "%Y"))) {
year_date <- as.Date(paste(year, "-01-01", sep = ""))
# extant facilities
fac_exist <- facs %>%
filter(start_date <= year_date) %>%
distinct(facility_name)  # Get unique facility names
n_fac_exist <- nrow(fac_exist)
# spotted facilities
fac_spotted <- fac_caps %>%
filter(Acquisitio <= year_date) %>%
distinct(facility_name)  # Get unique facility names
spotted <- unique(append(spotted,fac_spotted$facility_name))
fac_caps <- fac_caps %>%
filter(Acquisitio > year_date)
n_fac_spotted <- length(spotted)
coverage <- bind_rows(coverage, data.frame(year = year,
num_extant_facilities = n_fac_exist,
num_spotted_facilities = n_fac_spotted,
coverage = n_fac_spotted / n_fac_exist))
}
ggplot(coverage, aes(x = year)) +
geom_ribbon(aes(ymin = 0, ymax = num_extant_facilities, fill = "Extant Facilities"), alpha = 0.75) +
geom_ribbon(aes(ymin = 0, ymax = num_spotted_facilities, fill = "Spotted Facilities"), alpha = 0.75) +
scale_fill_manual(values = c("Extant Facilities" = "#7eb0d5", "Spotted Facilities" = "#fd7f6f")) +
labs(y = "Coverage",
x = "Year",
fill = "") +
theme_minimal()
View(miss_caps)
View(missiles)
# Build coverage DF
coverage <- data.frame(year = integer(),
num_extant_facilities = integer(),
num_spotted_facilities = integer(),
coverage = double())
spotted <- c()
for (year in as.integer(format(min_date, "%Y")):as.integer(format(max_date, "%Y"))) {
year_date <- as.Date(paste(year, "-01-01", sep = ""))
# extant facilities
fac_exist <- facs %>%
filter(start_date <= year_date) %>%
distinct(facility_name)  # Get unique facility names
n_fac_exist <- nrow(fac_exist)
# spotted facilities
fac_spotted <- fac_caps %>%
filter(Acquisitio <= year_date) %>%
distinct(facility_name)  # Get unique facility names
spotted <- unique(append(spotted,fac_spotted$facility_name))
fac_caps <- fac_caps %>%
filter(Acquisitio > year_date)
n_fac_spotted <- length(spotted)
coverage <- bind_rows(coverage, data.frame(year = year,
num_extant_facilities = n_fac_exist,
num_spotted_facilities = n_fac_spotted,
coverage = n_fac_spotted / n_fac_exist))
}
## Plot
ggplot(coverage, aes(x = year)) +
geom_ribbon(aes(ymin = 0, ymax = num_extant_facilities, fill = "Extant Facilities"), alpha = 0.75) +
geom_ribbon(aes(ymin = 0, ymax = num_spotted_facilities, fill = "Spotted Facilities"), alpha = 0.75) +
scale_fill_manual(values = c("Extant Facilities" = "#7eb0d5", "Spotted Facilities" = "#fd7f6f")) +
labs(y = "Coverage",
x = "Year",
fill = "") +
theme_minimal()
# Build coverage DF
coverage <- data.frame(year = integer(),
num_extant_facilities = integer(),
num_spotted_facilities = integer(),
coverage = double())
spotted <- c()
for (year in as.integer(format(min_date, "%Y")):as.integer(format(max_date, "%Y"))) {
year_date <- as.Date(paste(year, "-01-01", sep = ""))
# extant facilities
miss_exist <- misss %>%
filter(start_date <= year_date) %>%
distinct(addres_found)  # Get unique facility names
n_miss_exist <- nrow(miss_exist)
# spotted missilities
miss_spotted <- miss_caps %>%
filter(Acquisitio <= year_date) %>%
distinct(address_found)  # Get unique missility names
spotted <- unique(append(spotted,miss_spotted$missility_name))
miss_caps <- miss_caps %>%
filter(Acquisitio > year_date)
n_miss_spotted <- length(spotted)
coverage <- bind_rows(coverage, data.frame(year = year,
num_extant_missilities = n_miss_exist,
num_spotted_missilities = n_miss_spotted,
coverage = n_miss_spotted / n_miss_exist))
}
# Build coverage DF
coverage <- data.frame(year = integer(),
num_extant_facilities = integer(),
num_spotted_facilities = integer(),
coverage = double())
spotted <- c()
for (year in as.integer(format(min_date, "%Y")):as.integer(format(max_date, "%Y"))) {
year_date <- as.Date(paste(year, "-01-01", sep = ""))
# extant facilities
miss_exist <- missiles %>%
filter(start_date <= year_date) %>%
distinct(addres_found)  # Get unique facility names
n_miss_exist <- nrow(miss_exist)
# spotted missilities
miss_spotted <- miss_caps %>%
filter(Acquisitio <= year_date) %>%
distinct(address_found)  # Get unique missility names
spotted <- unique(append(spotted,miss_spotted$missility_name))
miss_caps <- miss_caps %>%
filter(Acquisitio > year_date)
n_miss_spotted <- length(spotted)
coverage <- bind_rows(coverage, data.frame(year = year,
num_extant_missilities = n_miss_exist,
num_spotted_missilities = n_miss_spotted,
coverage = n_miss_spotted / n_miss_exist))
}
View(miss_caps)
View(missiles)
# Build coverage DF
coverage <- data.frame(year = integer(),
num_extant_facilities = integer(),
num_spotted_facilities = integer(),
coverage = double())
spotted <- c()
for (year in as.integer(format(min_date, "%Y")):as.integer(format(max_date, "%Y"))) {
year_date <- as.Date(paste(year, "-01-01", sep = ""))
# extant facilities
miss_exist <- missiles %>%
filter(start_date <= year_date) %>%
distinct(address_found)  # Get unique facility names
n_miss_exist <- nrow(miss_exist)
# spotted missilities
miss_spotted <- miss_caps %>%
filter(Acquisitio <= year_date) %>%
distinct(address_found)  # Get unique missility names
spotted <- unique(append(spotted,miss_spotted$missility_name))
miss_caps <- miss_caps %>%
filter(Acquisitio > year_date)
n_miss_spotted <- length(spotted)
coverage <- bind_rows(coverage, data.frame(year = year,
num_extant_missilities = n_miss_exist,
num_spotted_missilities = n_miss_spotted,
coverage = n_miss_spotted / n_miss_exist))
}
## Plot
ggplot(coverage, aes(x = year)) +
geom_ribbon(aes(ymin = 0, ymax = num_extant_missilities, fill = "Extant missilities"), alpha = 0.75) +
geom_ribbon(aes(ymin = 0, ymax = num_spotted_missilities, fill = "Spotted missilities"), alpha = 0.75) +
scale_fill_manual(values = c("Extant missilities" = "#7eb0d5", "Spotted missilities" = "#fd7f6f")) +
labs(y = "Coverage",
x = "Year",
fill = "") +
theme_minimal()
# Build coverage DF
coverage <- data.frame(year = integer(),
num_extant_facilities = integer(),
num_spotted_facilities = integer(),
coverage = double())
spotted <- c()
for (year in as.integer(format(min_date, "%Y")):as.integer(format(max_date, "%Y"))) {
year_date <- as.Date(paste(year, "-01-01", sep = ""))
# extant facilities
miss_exist <- missiles %>%
filter(start_date <= year_date) %>%
distinct(address_found)  # Get unique facility names
n_miss_exist <- nrow(miss_exist)
# spotted missilities
miss_spotted <- miss_caps %>%
filter(Acquisitio <= year_date) %>%
distinct(address_found)  # Get unique missility names
spotted <- unique(append(spotted,miss_spotted$address_found))
miss_caps <- miss_caps %>%
filter(Acquisitio > year_date)
n_miss_spotted <- length(spotted)
coverage <- bind_rows(coverage, data.frame(year = year,
num_extant_missilities = n_miss_exist,
num_spotted_missilities = n_miss_spotted,
coverage = n_miss_spotted / n_miss_exist))
}
## Plot
ggplot(coverage, aes(x = year)) +
geom_ribbon(aes(ymin = 0, ymax = num_extant_missilities, fill = "Extant missilities"), alpha = 0.75) +
geom_ribbon(aes(ymin = 0, ymax = num_spotted_missilities, fill = "Spotted missilities"), alpha = 0.75) +
scale_fill_manual(values = c("Extant missilities" = "#7eb0d5", "Spotted missilities" = "#fd7f6f")) +
labs(y = "Coverage",
x = "Year",
fill = "") +
theme_minimal()
# Build coverage DF
coverage <- data.frame(year = integer(),
num_extant_facilities = integer(),
num_spotted_facilities = integer(),
coverage = double())
spotted <- c()
for (year in as.integer(format(min_date, "%Y")):as.integer(format(max_date, "%Y"))) {
year_date <- as.Date(paste(year, "-01-01", sep = ""))
# extant facilities
fac_exist <- facs %>%
filter(start_date <= year_date) %>%
distinct(facility_name)  # Get unique facility names
n_fac_exist <- nrow(fac_exist)
# spotted facilities
fac_spotted <- fac_caps %>%
filter(Acquisitio <= year_date) %>%
distinct(facility_name)  # Get unique facility names
spotted <- unique(append(spotted,fac_spotted$facility_name))
fac_caps <- fac_caps %>%
filter(Acquisitio > year_date)
n_fac_spotted <- length(spotted)
coverage <- bind_rows(coverage, data.frame(year = year,
num_extant_facilities = n_fac_exist,
num_spotted_facilities = n_fac_spotted,
coverage = n_fac_spotted / n_fac_exist))
}
## Plot
ggplot(coverage, aes(x = year)) +
geom_ribbon(aes(ymin = 0, ymax = num_extant_facilities, fill = "Extant Facilities"), alpha = 0.75) +
geom_ribbon(aes(ymin = 0, ymax = num_spotted_facilities, fill = "Spotted Facilities"), alpha = 0.75) +
scale_fill_manual(values = c("Extant Facilities" = "#7eb0d5", "Spotted Facilities" = "#fd7f6f")) +
labs(y = "Coverage",
x = "Year",
fill = "") +
theme_minimal()
facs <- read_csv("facilities.csv")[-1]
missiles <- read_csv("missiles.csv")[-1]
fac_caps <- read_csv("fac_captures.csv")[-1]
miss_caps <- read_csv("miss_captures.csv")[-1]
# get date range
min_date = min(append(facs$start_date, missiles$start_date), na.rm = TRUE)
max_date = max(append(facs$start_date, missiles$start_date), na.rm = TRUE)
# Build coverage DF
coverage <- data.frame(year = integer(),
num_extant_facilities = integer(),
num_spotted_facilities = integer(),
coverage = double())
spotted <- c()
for (year in as.integer(format(min_date, "%Y")):as.integer(format(max_date, "%Y"))) {
year_date <- as.Date(paste(year, "-01-01", sep = ""))
# extant facilities
fac_exist <- facs %>%
filter(start_date <= year_date) %>%
distinct(facility_name)  # Get unique facility names
n_fac_exist <- nrow(fac_exist)
# spotted facilities
fac_spotted <- fac_caps %>%
filter(Acquisitio <= year_date) %>%
distinct(facility_name)  # Get unique facility names
spotted <- unique(append(spotted,fac_spotted$facility_name))
fac_caps <- fac_caps %>%
filter(Acquisitio > year_date)
n_fac_spotted <- length(spotted)
coverage <- bind_rows(coverage, data.frame(year = year,
num_extant_facilities = n_fac_exist,
num_spotted_facilities = n_fac_spotted,
coverage = n_fac_spotted / n_fac_exist))
}
## Plot
ggplot(coverage, aes(x = year)) +
geom_ribbon(aes(ymin = 0, ymax = num_extant_facilities, fill = "Extant Facilities"), alpha = 0.75) +
geom_ribbon(aes(ymin = 0, ymax = num_spotted_facilities, fill = "Spotted Facilities"), alpha = 0.75) +
scale_fill_manual(values = c("Extant Facilities" = "#7eb0d5", "Spotted Facilities" = "#fd7f6f")) +
labs(y = "Coverage",
x = "Year",
fill = "") +
theme_minimal()
# Build coverage DF
coverage <- data.frame(year = integer(),
num_extant_facilities = integer(),
num_spotted_facilities = integer(),
coverage = double())
spotted <- c()
for (year in as.integer(format(min_date, "%Y")):as.integer(format(max_date, "%Y"))) {
year_date <- as.Date(paste(year, "-01-01", sep = ""))
# extant facilities
miss_exist <- missiles %>%
filter(start_date <= year_date) %>%
distinct(address_found)  # Get unique facility names
n_miss_exist <- nrow(miss_exist)
# spotted missilities
miss_spotted <- miss_caps %>%
filter(Acquisitio <= year_date) %>%
distinct(address_found)  # Get unique missility names
spotted <- unique(append(spotted,miss_spotted$address_found))
miss_caps <- miss_caps %>%
filter(Acquisitio > year_date)
n_miss_spotted <- length(spotted)
coverage <- bind_rows(coverage, data.frame(year = year,
num_extant_missilities = n_miss_exist,
num_spotted_missilities = n_miss_spotted,
coverage = n_miss_spotted / n_miss_exist))
}
## Plot
ggplot(coverage, aes(x = year)) +
geom_ribbon(aes(ymin = 0, ymax = num_extant_missilities, fill = "Extant missilities"), alpha = 0.75) +
geom_ribbon(aes(ymin = 0, ymax = num_spotted_missilities, fill = "Spotted missilities"), alpha = 0.75) +
scale_fill_manual(values = c("Extant missilities" = "#7eb0d5", "Spotted missilities" = "#fd7f6f")) +
labs(y = "Coverage",
x = "Year",
fill = "") +
theme_minimal()
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(shiny)
library(shinyjs)
library(leaflet)
facs <- read_csv("facilities.csv")[-1]
missiles <- read_csv("missiles.csv")[-1]
fac_caps_orig <- read_csv("fac_captures.csv")[-1]
miss_caps_orig <- read_csv("miss_captures.csv")[-1]
# get date range
min_date = min(append(facs$start_date, missiles$start_date), na.rm = TRUE)
max_date = max(append(facs$start_date, missiles$start_date), na.rm = TRUE)
fac_caps <- fac_caps_orig
# Build coverage DF
coverage <- data.frame(year = integer(),
num_extant_facilities = integer(),
num_spotted_facilities = integer(),
coverage = double())
spotted <- c()
for (year in as.integer(format(min_date, "%Y")):as.integer(format(max_date, "%Y"))) {
year_date <- as.Date(paste(year, "-01-01", sep = ""))
# extant facilities
fac_exist <- facs %>%
filter(start_date <= year_date) %>%
distinct(facility_name)  # Get unique facility names
n_fac_exist <- nrow(fac_exist)
# spotted facilities
fac_spotted <- fac_caps %>%
filter(Acquisitio <= year_date) %>%
distinct(facility_name)  # Get unique facility names
spotted <- unique(append(spotted,fac_spotted$facility_name))
fac_caps <- fac_caps %>%
filter(Acquisitio > year_date)
n_fac_spotted <- length(spotted)
coverage <- bind_rows(coverage, data.frame(year = year,
num_extant_facilities = n_fac_exist,
num_spotted_facilities = n_fac_spotted,
coverage = n_fac_spotted / n_fac_exist))
}
## Plot
ggplot(coverage, aes(x = year)) +
geom_ribbon(aes(ymin = 0, ymax = num_extant_facilities, fill = "Extant Facilities"), alpha = 0.75) +
geom_ribbon(aes(ymin = 0, ymax = num_spotted_facilities, fill = "Spotted Facilities"), alpha = 0.75) +
scale_fill_manual(values = c("Extant Facilities" = "#7eb0d5", "Spotted Facilities" = "#fd7f6f")) +
labs(y = "Coverage",
x = "Year",
fill = "") +
theme_minimal()
fac_caps <- fac_caps_orig
# Build coverage DF
coverage <- data.frame(year = integer(),
num_extant_facilities = integer(),
num_spotted_facilities = integer(),
coverage = double())
spotted <- c()
for (year in as.integer(format(min_date, "%Y")):as.integer(format(max_date, "%Y"))) {
year_date <- as.Date(paste(year, "-01-01", sep = ""))
# extant facilities
fac_exist <- facs %>%
filter(start_date <= year_date) %>%
distinct(facility_name)  # Get unique facility names
n_fac_exist <- nrow(fac_exist)
# spotted facilities
fac_spotted <- fac_caps %>%
filter(Acquisitio <= year_date) %>%
distinct(facility_name)  # Get unique facility names
spotted <- unique(append(spotted,fac_spotted$facility_name))
fac_caps <- fac_caps %>%
filter(Acquisitio > year_date)
n_fac_spotted <- length(spotted)
coverage <- bind_rows(coverage, data.frame(year = year,
num_extant_facilities = n_fac_exist,
num_spotted_facilities = n_fac_spotted,
coverage = n_fac_spotted / n_fac_exist))
}
## Plot
ggplot(coverage, aes(x = year)) +
geom_ribbon(aes(ymin = 0, ymax = num_extant_facilities, fill = "Extant Facilities"), alpha = 0.75) +
geom_ribbon(aes(ymin = 0, ymax = num_spotted_facilities, fill = "Spotted Facilities"), alpha = 0.75) +
scale_fill_manual(values = c("Extant Facilities" = "#7eb0d5", "Spotted Facilities" = "#fd7f6f")) +
labs(y = "Coverage",
x = "Year",
fill = "") +
theme_minimal()
miss_caps <- miss_caps_orig
# Build coverage DF
coverage <- data.frame(year = integer(),
num_extant_facilities = integer(),
num_spotted_facilities = integer(),
coverage = double())
spotted <- c()
for (year in as.integer(format(min_date, "%Y")):as.integer(format(max_date, "%Y"))) {
year_date <- as.Date(paste(year, "-01-01", sep = ""))
# extant facilities
miss_exist <- missiles %>%
filter(start_date <= year_date) %>%
distinct(address_found)  # Get unique facility names
n_miss_exist <- nrow(miss_exist)
# spotted missiles
miss_spotted <- miss_caps %>%
filter(Acquisitio <= year_date) %>%
distinct(address_found)  # Get unique missile names
spotted <- unique(append(spotted,miss_spotted$address_found))
miss_caps <- miss_caps %>%
filter(Acquisitio > year_date)
n_miss_spotted <- length(spotted)
coverage <- bind_rows(coverage, data.frame(year = year,
num_extant_missiles = n_miss_exist,
num_spotted_missiles = n_miss_spotted,
coverage = n_miss_spotted / n_miss_exist))
}
## Plot
ggplot(coverage, aes(x = year)) +
geom_ribbon(aes(ymin = 0, ymax = num_extant_missiles, fill = "Extant missiles"), alpha = 0.75) +
geom_ribbon(aes(ymin = 0, ymax = num_spotted_missiles, fill = "Spotted missiles"), alpha = 0.75) +
scale_fill_manual(values = c("Extant missiles" = "#7eb0d5", "Spotted missiles" = "#fd7f6f")) +
labs(y = "Coverage",
x = "Year",
fill = "") +
theme_minimal()
runApp('~/workspace/CORONA')
runApp('~/workspace/CORONA')
# captures <- read_csv("captures.csv")[-1]
fac_caps <- read_csv("fac_captures.csv")[-1]
# captures <- read_csv("captures.csv")[-1]
fac_caps <- read_csv("fac_captures.csv")[-1]
# captures <- read_csv("captures.csv")[-1]
fac_caps <- read_csv("fac_captures.csv")[-1]
getwd
getwd()
setwd("/Users/tobyweed/workspace/CORONA")
runApp()
# captures <- read_csv("captures.csv")[-1]
fac_caps <- read_csv("fac_captures.csv")[-1]
View(fac_caps)
runApp()
runApp()
runApp()
runApp()
